# 下一阶段开发计划（基于 Gap Analysis）

> 最新基线：参见《功能覆盖检查报告》（更新于 2025-09-30）。本计划聚焦优先级最高的缺口，并为后续迭代提供任务拆解与进度跟踪。

## 目标概览

1. **会话管理增强（Gap #3）**：提供历史搜索、重命名、删除与导出能力，保障长对话可维护。
2. **教程引导体验（Gap #3）**：构建首登引导步骤，帮助用户理解核心流程。
3. **对话服务补强（Gap #4）**：扩展后台服务以支持元数据维护，为后续附件、多模态奠定基础。
4. **Options 配置体验（Gap #2）**：实现导入/导出、导航与未保存提示，为复杂配置交互奠定基础。
5. **历史会话续聊（Gap #3）**：补全 Conversations 页面快捷指令与消息输入能力，保证与 Sidebar 一致的续聊体验。

## 迭代拆解

| 任务 ID | 关联里程碑 | 描述 | 依赖 | 验收标准 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- | --- |
| M1-T1 | M1 会话管理增强 | Conversations Tab 支持标题搜索与过滤 | 现有会话列表 | 输入关键字可实时过滤列表；选中项在过滤后保持有效 | ✅ 已完成 | `tabs/conversations.tsx` 已实现 | 
| M1-T2 | M1 会话管理增强 | 支持对会话进行重命名（更新标题与更新时间） | `background/services/conversation.ts` 更新接口 | 后台返回最新标题；UI 显示即时更新；附带单测 | ✅ 已完成 | 新增 `conversation:update` 消息路由 |
| M1-T3 | M1 会话管理增强 | 支持删除会话并刷新列表 | M1-T2 | 删除后会话从列表移除，若删除选中项需自动切换 | ✅ 已完成 | 包含删除确认与错误提示 |
| M1-T4 | M1 会话管理增强 | 导出入口预留批量操作扩展位并提供状态提示 | M1-T1 | 按钮具备导出 loading 状态与错误提示 | ✅ 已完成 | 维持单个导出，后续扩展批量 |
| M2-T1 | M2 教程引导流程 | 设计教程步骤组件 | 无 | 教程页展示至少 3 个步骤，支持 CTA 跳转 | ✅ 已完成 | Tutorial Tab 新增进度条与 CTA |
| M3-T1 | M3 对话服务补强 | ConversationService 支持元数据更新 | 存储服务 | 提供 `updateMeta` 方法并更新 `updatedAt` | ✅ 已完成 | 已覆盖单测 |
| M3-T2 | M3 对话服务补强 | 更新消息路由与前端调用 | M3-T1 | 消息契约新增 `conversation:update`，UI 可调用 | ✅ 已完成 | |
| M3-T3 | M3 对话服务补强 | 扩充单元测试覆盖 rename / delete | M3-T1 | `pnpm test` 通过，新增断言 | ✅ 已完成 | |
| M4-T1 | M4 Options 配置体验 | 新增配置导入/导出并校验文件格式 | 无 | 支持 JSON 文件导入、导出，异常时给出错误提示 | ✅ 已完成 | `options/index.tsx` 新增工具栏 |
| M4-T2 | M4 Options 配置体验 | 提供未保存变更提醒与禁用保存按钮 | M4-T1 | 修改配置后显示提醒，保存后清除 | ✅ 已完成 | 依赖 `useOptionsStore` 的 `isDirty` 状态 |
| M4-T3 | M4 Options 配置体验 | 优化导航布局以符合设计中的纵向菜单 | 无 | 菜单支持活动态标记与键盘可达性 | ✅ 已完成 | `NavigationMenu` 更新 |
| M4-T4 | M4 Options 配置体验 | 提供拖拽排序与浮动标签体验 | M4-T3 | 模型/快捷指令支持拖拽排序、浮动标签输入与状态统计 | ✅ 已完成 | `ModelsPage`、`ShortcutsPage` 引入 DraggableList |
| M4-T5 | M4 Options 配置体验 | 校验默认模型并同步状态面板 | M4-T4 | 保存时自动选择有效默认模型并展示启用统计 | ✅ 已完成 | `useOptionsStore` 增加默认模型守护 |
| M5-T1 | M5 历史会话续聊 | Conversations Tab 新增快捷指令区与模型选择器 | M1-T1 | 可直接点击快捷指令触发续聊，模型下拉与 Sidebar 保持一致 | ✅ 已完成 | `tabs/conversations.tsx` 新增快捷指令区 |
| M5-T2 | M5 历史会话续聊 | 添加消息输入区并复用后台发送流程 | M5-T1 | 历史页面可直接输入消息并走 `conversation:append` | ✅ 已完成 | `tabs/conversations.tsx` 新增输入表单 |
| M5-T3 | M5 历史会话续聊 | 维护会话列表排序并补充单测 | M5-T1 | 续聊或重命名后会话置顶，单测覆盖排序工具 | ✅ 已完成 | `tabs/conversations-utils.ts` + `tests/unit/tabs.conversations-utils.spec.ts` |

> 状态说明：✅ 已完成 · ⏳ 进行中 · ☐ 未开始

## 风险与后续关注

- **批量导出 / 多选能力**：需在下一迭代设计批量操作入口，避免按钮数量膨胀。
- **权限提示**：删除与重命名操作需补充权限提示与撤销（Undo）能力，未来与同步服务联动。
- **测试深度**：当前仅补充单元测试，后续需在 Playwright 测试中覆盖搜索与删除流程。

## 日志

- 2025-09-30：完成 M1-T1~T3、M3-T1~T3，并将进度同步至《实施路线图》。
- 2025-10-01：完成 M4-T1~T3，Options 页面具备导入/导出、未保存提示与纵向导航，Gap #2 的部分缺口得到缓解。
- 2025-10-02：完成 M2-T1、M4-T4~T5，并交付可拖拽排序、浮动标签与教程进度条；Sidebar 与 LLM 多模型流式功能同步上线。
- 2025-10-05：补齐自动同步、页面状态缓存与图片上传按钮，新增提取/同步单测与 Playwright 基线用例，并完成发布检查清单。
- 2025-10-06：Conversations Tab 完成内联重命名、附件预览与侧栏拖拽宽度，搜索扩展至 URL 关键字；ConversationService 增加字段清洗与排序单测，并同步更新实施路线图与覆盖报告。
- 2025-10-07：补齐历史页面续聊能力，新增快捷指令触发、模型切换、消息输入区与排序工具单元测试，Gap #3 中的续聊差距关闭。

